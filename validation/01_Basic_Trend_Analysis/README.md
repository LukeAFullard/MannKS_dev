# Validation: 01 - Basic Trend Analysis

This document compares the output of a basic trend analysis between the Python `MannKenSen` package and the original `LWP-TRENDS` R script.

## Methodology

A synthetic dataset with a known linear trend and random noise was generated using a Python script. This dataset was saved to a CSV file to ensure both the Python and R scripts performed their analysis on the exact same data.

### Python Script (`basic_trend.py`)

```python
import numpy as np
import pandas as pd
from MannKenSen import trend_test

def main():
    """
    Generate a simple linear time series with noise and perform a trend analysis.
    """
    # 1. Generate Synthetic Data
    np.random.seed(42)
    t = np.arange(2000, 2020, dtype=float)
    slope = 2.5
    intercept = 10
    noise = np.random.normal(0, 5, len(t))
    x = slope * (t - t[0]) + intercept + noise

    # Save data for R validation
    df = pd.DataFrame({'time': t, 'value': x})
    df.to_csv('validation/01_Basic_Trend_Analysis/validation_data.csv', index=False)

    # 2. Perform Trend Analysis
    plot_path = "validation/01_Basic_Trend_Analysis/basic_trend_plot.png"
    result = trend_test(x, t, plot_path=plot_path)

    # 3. Print the Results
    print("--- Basic Trend Analysis Results ---")
    print(f"  Classification: {result.classification}")
    print(f"  Trend: {result.trend}")
    print(f"  P-value: {result.p:.4f}")
    print(f"  Slope: {result.slope:.2f} ({result.lower_ci:.2f}, {result.upper_ci:.2f})")
    print(f"  Analysis Notes: {result.analysis_notes if result.analysis_notes else 'None'}")
    print(f"  Plot saved to: {plot_path}")

if __name__ == "__main__":
    main()
```

### R Script (`run_lwp_validation.R`)

```R
# Validation script for Basic Trend Analysis

# Load the LWP-TRENDS functions
suppressWarnings({
    source("Example_Files/R/LWPTrends_v2502/LWPTrends_v2502.r")
})

# Read the data generated by the Python script
data <- read.csv("validation/01_Basic_Trend_Analysis/validation_data.csv")

# --- Prepare the data for LWP-TRENDS ---
names(data) <- c("Year", "RawValue")
data$myDate <- as.Date(paste(data$Year, "-01-01", sep=""))
data$Censored <- FALSE
data$CenType <- "not"
data <- GetMoreDateInfo(data)
data$TimeIncr <- data$Year

# --- Run the non-seasonal trend analysis ---
result <- NonSeasonalTrendAnalysis(data, ValuesToUse = "RawValue", Year = "Year")

# --- Print the key results ---
cat("--- LWP-TRENDS Analysis Results ---\n")
cat(sprintf("  P-value: %.4f\n", result$p))
cat(sprintf("  Z-statistic: %.4f\n", result$Z))
cat(sprintf("  Slope: %.2f (%.2f, %.2f)\n", result$AnnualSenSlope, result$Sen_Lci, result$Sen_Uci))
cat(sprintf("  Trend Classification: %s\n", result$TrendDirection))
```

## Results Comparison

| Metric                 | MannKenSen (Python)         | LWP-TRENDS (R)              |
| ---------------------- | --------------------------- | --------------------------- |
| **P-value**            | 0.0000                      | 0.0000                      |
| **Z-statistic**        | 5.0938                      | 5.0938                      |
| **Sen's Slope**        | 2.04                        | 2.04                        |
| **90% Conf. Interval** | (1.67, 2.34)                | (1.70, 2.30)                |
| **Trend Classification** | Highly Likely Increasing    | Increasing                  |

### Analysis

The results from both packages are extremely close, confirming that the `MannKenSen` package is producing output consistent with the LWP-TRENDS R script for a basic, non-seasonal trend analysis.

- The **P-value, Z-statistic, and Sen's Slope** are identical.
- The **90% Confidence Intervals** are slightly different. This is expected, as the underlying statistical methods for calculating the confidence intervals can have minor implementation differences between packages.
- The **Trend Classification** is consistent in identifying an increasing trend, though the specific labels differ (`Highly Likely Increasing` vs. `Increasing`). This is due to different classification schemes and confidence thresholds in each package.

Overall, the validation is successful.
